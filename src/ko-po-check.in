#! /usr/bin/env python

import os,sys,po,poparse

moduledir = "@prefix@/share/ko-po-check"
filtersdir = moduledir + "/msgfilters"

sys.path.append(moduledir)

if sys.argv[1:]:
    fn = sys.argv[1]
    if fn == '-':
        fp = sys.stdin
    else:
        fp = open(fn)
else:
    import StringIO
    fp = StringIO.StringIO(test_input)

catalog = poparse.parse_file(fp)

import string,re
import glob

filters = glob.glob(filtersdir + "/*.py")
for filter in filters:
    f = {}
    execfile(filter, f)
    for entry in catalog.entries:
        t,e = f['check'](entry.msgid, entry.msgstr)
        if not t:
            print e
